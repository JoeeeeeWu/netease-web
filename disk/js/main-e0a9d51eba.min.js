window.onload=function(){function t(t){this.container=l.getObj.getElem(t),this.imgs=l.getObj.getAllElem(".c-slider__item",this.container),this.btns=l.getObj.getAllElem(".c-pointer__btn",this.container),this.cur=0,this.init()}function e(t){this.container=l.getObj.getElem(t),this.courseList=l.getObj.getElem(".l-list",this.container),this.pageContent=l.getObj.getElem(".c-page__content",this.container),this.prevBtn=l.getObj.getElem(".c-page__prev",this.container),this.nextBtn=l.getObj.getElem(".c-page__next",this.container),this.url="http://study.163.com/webDev/couresByCategory.htm",this.parameter={pageNo:1,psize:20,type:10},this.init()}function i(t){e.call(this,t),this.parameter={pageNo:1,psize:20,type:20}}function n(){this.designBtn=l.getObj.getElem(".js-designBtn"),this.codeBtn=l.getObj.getElem(".js-codeBtn"),this.designBox=l.getObj.getElem(".l-design"),this.codeBox=l.getObj.getElem(".l-code"),this.canload=!0,this.bind()}function s(){this.topList=l.getObj.getElem(".l-top"),this.url="http://study.163.com/webDev/hotcouresByCategory.htm",this.init()}function o(){this.poster=l.getObj.getElem(".c-org__img"),this.videoPanel=l.getObj.getElem(".l-video"),this.closeBtn=l.getObj.getElem(".c-video__closebtn"),this.bind()}function a(){this.loginPanel=l.getObj.getElem(".l-login"),this.closeBtn=l.getObj.getElem(".c-login__closebtn",this.loginPanel),this.submitBtn=l.getObj.getElem(".c-login__submitbtn",this.loginPanel),this.followBtn=l.getObj.getElem(".c-followbtn"),this.cancleBtn=l.getObj.getElem(".c-canclebtn"),this.init()}function c(){this.topBar=l.getObj.getElem(".l-topbar"),this.topBarCloseBtn=l.getObj.getElem(".c-topbar__warn"),this.bind()}var l={getObj:{getElem:function(t,e){return e?e.querySelector(t):document.querySelector(t)},getAllElem:function(t,e){return e?e.querySelectorAll(t):document.querySelectorAll(t)}},cookieMether:{setCookie:function(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+";expires="+n.toGMTString()},getCookie:function(t){for(var e=document.cookie.split(";"),i=0;i<e.length;i++){var n=e[i].split("=");if(n[0].replace(/(^\s*)|(\s*$)/g,"")===t)return encodeURIComponent(n[1])}},removeCookie:function(t){this.setCookie(t,"",-1)}},getStyle:function(t,e){var i="";return i=t.currentStyle?t.currentStyle[e]:getComputedStyle(t)[e],i="opacity"==e?Math.round(100*parseFloat(i)):parseInt(i)},classMether:{hasClass:function(t,e){return t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},removeClass:function(t,e){var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")},addClass:function(t,e){t.className+=this.hasClass(t,e)?"":" "+e}},getData:function(t,e,i){function n(t){if(!t)return"";var e=[];for(var i in t)if(t.hasOwnProperty(i)&&"function"!=typeof t[i]){var n=t[i].toString();i=encodeURIComponent(i),n=encodeURIComponent(n),e.push(i+"="+n)}return e.join("&")}var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&(s.status>=200&&s.status<300||304==s.status?e(s.responseText):alert("request failed:"+s.status))},s.open("get",t+"?"+n(i),!0),s.send(null)},inherit:{inheritObject:function(t){function e(){}return e.prototype=t,new e},inheritPrototype:function(t,e){var i=this.inheritObject(e.prototype);i.constructor=t,t.prototype=i}}};t.prototype.init=function(){this.timer=setInterval(this.autoPlay.bind(this),3e3),this.hover(),this.clickBtn()},t.prototype.clickBtn=function(){for(var t=0;t<this.btns.length;t++){this.btns[t].index=t;var e=this;this.btns[t].onclick=function(){e.cur=this.index,e.switchImg()}}},t.prototype.switchImg=function(){for(var t=0;t<this.btns.length;t++)l.classMether.removeClass(this.btns[t],"c-pointer__btn--active");l.classMether.addClass(this.btns[this.cur],"c-pointer__btn--active");for(var e=0;e<this.imgs.length;e++)this.animateImg(this.imgs[e],0);this.animateImg(this.imgs[this.cur],100)},t.prototype.animateImg=function(t,e){var i=0;clearInterval(t.timer),t.timer=setInterval(function(){i=l.getStyle(t,"opacity");var n=0;i>e?n=-5:i<e&&(n=5),i==e?clearInterval(t.timer):(i+=n,t.style.opacity=i/100,t.style.filter="alpha(opacity:"+i+")")},30)},t.prototype.hover=function(){var t=this;this.container.onmouseenter=function(){clearInterval(t.timer)},this.container.onmouseleave=function(){t.timer=setInterval(t.autoPlay.bind(t),3e3)}},t.prototype.autoPlay=function(){this.cur==this.imgs.length-1?this.cur=0:this.cur++,this.switchImg()},new t(".c-slider"),e.prototype.init=function(){l.getData(this.url,this.insertData.bind(this),this.parameter),this.changePage()},e.prototype.insertData=function(t){this.courseList.innerHTML="",this.pageContent.innerHTML="";for(var t=JSON.parse(t),e=0;e<t.list.length;e++){t.list[e].price?t.list[e].price="￥"+t.list[e].price:t.list[e].price="免费",t.list[e].categoryName||(t.list[e].categoryName="暂无分类");var i='<li class = "l-list__item"><div class="c-card"><div class="c-card__imgwrap"><img src = '+t.list[e].middlePhotoUrl+' class="c-card__img"></div><h3 class="c-card__title">'+t.list[e].name+'</h3><span class="c-card__provider">'+t.list[e].provider+'</span><span class="c-card__count">'+t.list[e].learnerCount+'人学过</span><span class="c-card__price">'+t.list[e].price+'</span></div><div class="c-bigcard"><div class="c-bigcard__imgwrap"><img src='+t.list[e].middlePhotoUrl+' class="c-bigcard__img"></div><div class="c-bigcard__content u-clearfix"><h3 class="c-bigcard__title">'+t.list[e].name+'</h3><span class="c-bigcard__count">'+t.list[e].learnerCount+'人在学</span><span class="c-bigcard__provider">发布者：'+t.list[e].provider+'</span><span class="c-bigcard__category"> 分类：'+t.list[e].categoryName+'</span></div><p class="c-bigcard__desc">'+t.list[e].description+"</p> </div> </li>";this.courseList.innerHTML+=i}this.totalPage=t.totalPage;for(var n=1;n<this.totalPage+1;n++){var s='<span class="c-page__item">'+n+"</span>";this.pageContent.innerHTML+=s}this.pageBtn=l.getObj.getAllElem(".c-page__item",this.pageContent),l.classMether.addClass(this.pageBtn[this.parameter.pageNo-1],"c-page__item--active"),this.clickPage()},e.prototype.clickPage=function(){for(var t=0;t<this.pageBtn.length;t++){this.pageBtn[t].index=t;var e=this;this.pageBtn[t].onclick=function(){l.classMether.removeClass(e.pageBtn[e.parameter.pageNo-1],"c-page__item--active"),e.parameter.pageNo=this.index+1,l.classMether.addClass(e.pageBtn[e.parameter.pageNo-1],"c-page__item--active"),l.getData(e.url,e.insertData.bind(e),e.parameter)}}},e.prototype.changePage=function(){var t=this;this.prevBtn.onclick=function(){t.parameter.pageNo>1&&(l.classMether.removeClass(t.pageBtn[t.parameter.pageNo-1],"c-page__item--active"),t.parameter.pageNo--,l.classMether.addClass(t.pageBtn[t.parameter.pageNo-1],"c-page__item--active"),l.getData(t.url,t.insertData.bind(t),t.parameter))},this.nextBtn.onclick=function(){t.parameter.pageNo<t.totalPage&&(l.classMether.removeClass(t.pageBtn[t.parameter.pageNo-1],"c-page__item--active"),t.parameter.pageNo++,l.classMether.addClass(t.pageBtn[t.parameter.pageNo-1],"c-page__item--active"),l.getData(t.url,t.insertData.bind(t),t.parameter))}},new e(".l-design"),l.inherit.inheritPrototype(i,e),n.prototype.bind=function(){this.clickDesignBtn(),this.clickCodeBtn()},n.prototype.clickDesignBtn=function(){var t=this;this.designBtn.onclick=function(){l.classMether.removeClass(t.codeBtn,"c-course__btn--active"),l.classMether.addClass(t.designBtn,"c-course__btn--active"),l.classMether.removeClass(t.designBox,"l-hidden"),l.classMether.addClass(t.codeBox,"l-hidden")}},n.prototype.clickCodeBtn=function(){var t=this;this.codeBtn.onclick=function(){l.classMether.removeClass(t.designBtn,"c-course__btn--active"),l.classMether.addClass(t.codeBtn,"c-course__btn--active"),l.classMether.removeClass(t.codeBox,"l-hidden"),l.classMether.addClass(t.designBox,"l-hidden"),t.canload&&(new i(".l-code"),t.canload=!1)}},new n,s.prototype.init=function(){l.getData(this.url,this.insertData.bind(this)),this.autoScroll()},s.prototype.insertData=function(t){for(var t=JSON.parse(t),e=0;e<t.length;e++){var i='<li class="c-topcard"><div class="c-topcard__imgwrap"><img src='+t[e].smallPhotoUrl+' alt="hot" class="c-topcard__img"></div><div class="c-topcard__content"><span class="c-topcard__title">'+t[e].name+'</span><span class="c-topcard__count">'+t[e].learnerCount+"人学过</span></div></li>";this.topList.innerHTML+=i}},s.prototype.animateScroll=function(){var t=0,e=this,i=setInterval(function(){5*t>70&&clearInterval(i),e.topList.style.top=parseFloat(l.getStyle(e.topList,"top"))-5+"px",t++},30)},s.prototype.autoScroll=function(){var t=this;this.timer=setInterval(this.scroll.bind(this),3e3),this.topList.onmouseenter=function(){clearInterval(t.timer)},this.topList.onmouseleave=function(){t.timer=setInterval(t.scroll.bind(t),2e3)}},s.prototype.scroll=function(){var t=this;if(parseFloat(l.getStyle(this.topList,"top"))<-700)var e=setInterval(function(){parseFloat(l.getStyle(t.topList,"top"))>=0&&clearInterval(e),t.topList.style.top=parseFloat(l.getStyle(t.topList,"top"))+20+"px"},30);this.animateScroll()},new s,o.prototype.bind=function(){var t=this;this.poster.onclick=function(){t.videoPanel.style.display="block"},this.closeBtn.onclick=function(){t.videoPanel.style.display="none"}},new o,a.prototype.init=function(){this.onloadWindow(),this.clickCloseBtn(),this.clickSubmitBtn(),this.clickCancleBtn()},a.prototype.clickCancleBtn=function(){var t=this;this.cancleBtn.onclick=function(){l.cookieMether.removeCookie("followSuc"),this.style.display="none",t.followBtn.disabled=!1,t.followBtn.value="+关注"}},a.prototype.onloadWindow=function(){var t=this;l.cookieMether.getCookie("loginSuc")?l.cookieMether.getCookie("followSuc")?this.followSuccess():this.followBtn.onclick=function(){t.followSuccess()}:this.followBtn.onclick=function(){t.loginPanel.style.display="block"}},a.prototype.clickCloseBtn=function(){var t=this;this.closeBtn.onclick=function(){t.loginPanel.style.display="none"}},a.prototype.clickSubmitBtn=function(){var t=this;this.submitBtn.onclick=function(){t.nameInput=l.getObj.getElem(".js-name",t.loginPanel),t.passwordInput=l.getObj.getElem(".js-password",t.loginPanel);var e=hex_md5(t.nameInput.value),i=hex_md5(t.passwordInput.value);l.getData("http://study.163.com/webDev/login.htm",t.submitHandle.bind(t),{userName:e,password:i})}},a.prototype.submitHandle=function(t){"1"===t?(this.loginPanel.style.display="none",l.cookieMether.setCookie("loginSuc","1",2),l.getData("http://study.163.com/webDev/attention.htm",this.followHandle.bind(this))):alert("账号或密码错误，请重新输入！")},a.prototype.followHandle=function(t){"1"===t&&(l.cookieMether.setCookie("followSuc","1",2),this.followSuccess())},a.prototype.followSuccess=function(){var t=this;this.followBtn.value="已关注",this.followBtn.disabled=!0,this.cancleBtn.style.display="inline-block",this.followBtn.onclick=function(){t.followBtn.value="已关注",t.followBtn.disabled=!0,t.cancleBtn.style.display="inline-block",l.cookieMether.setCookie("followSuc","1",2)}},new a,c.prototype.bind=function(){var t=this;l.cookieMether.getCookie("close")?this.topBar.style.display="none":this.topBarCloseBtn.onclick=function(){t.topBar.style.display="none",l.cookieMether.setCookie("close","1",2)}},new c};